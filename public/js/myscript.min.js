$(document).ready(function(){var a='http://localhost/myportpolio/workorder/public/',t=$(".statuswo").val();0==$("#totalpembelian").val()&&$(':input[type="submit"]').prop("disabled",!0),"Closed"==t&&$(':input[type="submit"]').prop("disabled",!0),$('[data-toggle="popover"]').popover({trigger:"focus"}),$(".zoom").hover(function(){$(this).addClass("transisi")},function(){$(this).removeClass("transisi")}),$("#beli-material").select2();var r=$("#jmldata").val();$("#add-material").click(function(){var i=$("#beli-material").val();console.log(i),$.ajax({url:a+"material/getMaterial",data:{id_material:i},method:"post",dataType:"json",success:function(t){console.log(JSON.stringify(t));var a=$("#jumlah-beli").val(),e=$("#harga-total").val();console.log(a),console.log(e);var o=e/a,l=t.nama_material,t=t.satuan;r++,$("#tbl-pembelian").append('<tr id="row'+r+'"><td><input size="10" style="border:0;outline:0" name="id_material[]" value="'+i+'" readonly></td><td>'+l+'</td><td><input size="10" style="border:0;outline:0" name="qty[]" value="'+a+'" readonly></td><td>'+t+'</td><td><input size="10" style="border:0;outline:0" name="harga[]" value="'+o+'" readonly></td><td><input size="10" style="border:0;outline:0" name="total-beli[]" class="subtotal-beli" value="'+e+'" readonly></td><td><button type="button" name="hapus" id="'+r+'" class="btn btn-danger btn-sm btn_remove"><i class="fas fa-fw fa-trash"></i></button></td></tr>');var n=0;$(".subtotal-beli").each(function(){n+=+$(this).val()}),console.log(n),$(".grandtotal").html(n),$(".grandtotal").val(n),$("#harga-total").val(0),$("#jumlah-beli").val(1),0==n?$(':input[type="submit"]').prop("disabled",!0):$(':input[type="submit"]').prop("disabled",!1)}})}),$(document).on("click",".btn_remove",function(){var t=$(this).attr("id");$("#row"+t).remove();var a=0;$(".subtotal-beli").each(function(){a+=+$(this).val()}),console.log(a),$(".grandtotal").html(a),$(".grandtotal").val(a),0==a?$(':input[type="submit"]').prop("disabled",!0):$(':input[type="submit"]').prop("disabled",!1)}),$(".hapus-baris").on("click",function(){var t=$(this).attr("id");$("#row"+t).remove();var a=0;$(".total-biaya").each(function(){a+=+$(this).val()}),console.log(a),$(".grandtotal").html(a),$("#biaya").val(a)}),$(".field-material").select2(),$(".field-material").on("change",function(){var t=$(this).val();console.log(t);var o=$(this).attr("id");$.ajax({url:a+"material/getMaterial",data:{id_material:t},method:"post",dataType:"json",success:function(t){console.log(JSON.stringify(t));var a=$(".qty"+o).val()*t.harga;$(".harga"+o).val(t.harga),$(".satuan"+o).val(t.satuan),$("#total"+o).val(a);var e=0;$(".total-biaya").each(function(){e+=+$(this).val()}),console.log(e),$(".grandtotal").html(e),$("#biaya").val(e)}})}),$("input[name*='qty']").on("change",function(){var t=$(this).val(),a=$(this).attr("id"),t=t*$(".harga"+a).val();$("#total"+a).val(t);var e=0;$(".total-biaya").each(function(){e+=+$(this).val()}),console.log(e),$(".grandtotal").html(e),$("#biaya").val(e)}),$(".list-wo-finished").on("change",function(){var t=$(this).val();console.log(t),$.ajax({url:a+"activity/getCompleted",data:{id_wo:t},method:"post",dataType:"json",success:function(t){console.log(t),0<t?($(':input[type="submit"]').prop("disabled",!0),Swal.fire({icon:"error",title:"Oops...",text:"Work Order ini ada activity yang belum Completed !!"})):$(':input[type="submit"]').prop("disabled",!1)}})}),$(".teknisi-project-handled").on("change",function(){var t=$(this).val();console.log(t),$.ajax({url:a+"teknisi/getActiveproject",data:{id_teknisi:t},method:"post",dataType:"json",success:function(t){console.log(JSON.stringify(t)),0<t&&Swal.fire("Task overload ?","Teknisi sudah handle "+t+" work order Active","question")}})}),$(".wo-tanpa-biaya").on("change",function(){var t=$(this).val();console.log(t),$.ajax({url:a+"pembelian/getPlanpembelian",data:{id_wo:t},method:"post",dataType:"json",success:function(t){console.log(JSON.stringify(t)),0==t.plan_biaya&&Swal.fire("Mau beli material ?","Work order ini menggunakan material bekas, plan biaya 0","question")}}),$.ajax({url:a+"pembelian/getCash",data:{id_wo:t},method:"post",dataType:"json",success:function(t){console.log(JSON.stringify(t)),t&&Swal.fire("Mau beli material ?","Dana cash belum diambil di Finance !","question")}})}),$(".custom-file-input").on("change",function(){var t;2e6<this.files[0].size?(t=$(this).val().split("\\").pop(),$(this).next(".custom-file-label").addClass("selected").html(t),$(':input[type="submit"]').prop("disabled",!0),Swal.fire({icon:"error",title:"Oops...",text:"File yang Anda upload lebih dari 2Mb !!"})):($(':input[type="submit"]').prop("disabled",!1),t=$(this).val().split("\\").pop(),$(this).next(".custom-file-label").addClass("selected").html(t))}),$(".tombol-hapus").on("click",function(t){t.preventDefault();var a=$(this).attr("href");Swal.fire({title:"Apakah Anda Yakin ?",text:"Data yang Anda hapus tidak dapat di Recovery !",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Saya yakin !"}).then(t=>{t.value&&(document.location.href=a)})}),$(".modalShowActivity").on("click",function(){$("#tblmodalactivity tr:not(:first)").remove();var t=$(this).data("id_wo");$.ajax({url:a+"antrian/getActivity",data:{id_wo:t},method:"post",dataType:"json",success:function(a){console.log(a[0].tgl_activity);for(let t=0;t<a.length;t++)$("#tblmodalactivity").append('<tr><td style="text-align:center">'+(t+1)+"</td><td>"+a[t].tgl_activity+"</td><td>"+a[t].nama_activity+"</td><td>"+a[t].status+"</td></tr>")}})}),$(".modalShowProblem").on("click",function(){$("#tblmodalproblem tr:not(:first)").remove();var t=$(this).data("id_wo");console.log(t),$.ajax({url:a+"workorder/getProblem",data:{id_wo:t},method:"post",dataType:"json",success:function(a){console.log(JSON.stringify(a));for(let t=0;t<a.length;t++)$("#tblmodalproblem").append('<tr><td style="text-align:center">'+(t+1)+"</td><td>"+a[t].id_wo+"</td><td>"+a[t].problem+"</td><td>"+a[t].tindak_lanjut+"</td><td>"+a[t].pic+"</td><td>"+a[t].status+"</td></tr>")}})}),$(".modalAddEstimasi").on("click",function(){var t=$(this).data("id_wo");console.log(t),$("#id_wo_estimasi").val(t)}),$(".modalEditRole").on("click",function(){$(".tombolTambahRole").on("click",function(){$("#judulModal").html("Tambah Role"),$(".modal-footer button[type=submit]").html("Tambah Data"),$("#role").val("")}),$("#judulModal").html("Update Role"),$(".modal-footer button[type=submit]").html("Update Data"),$(".modal-body form").attr("action",a+"role/update");var t=$(this).data("id_role");$.ajax({url:a+"role/getEdit",data:{id_role:t},method:"post",dataType:"json",success:function(t){console.log("data"),$("#id_role").val(t.id_role),$("#role").val(t.role)}})}),$(".modalEditMenu").on("click",function(){$(".tombolTambahMenu").on("click",function(){$("#judulModal").html("Tambah Menu"),$(".modal-footer button[type=submit]").html("Tambah Data"),$("#menu").val("")}),$("#judulModal").html("Update Menu"),$(".modal-footer button[type=submit]").html("Update Data"),$(".modal-body form").attr("action",a+"menu/updateMenu");var t=$(this).data("id_menu");$.ajax({url:a+"menu/getEdit",data:{id_menu:t},method:"post",dataType:"json",success:function(t){$("#id_menu").val(t.id_menu),$("#menu").val(t.nama_menu)}})}),$("#tblworkorder").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[10]}],order:[0,"asc"],lengthMenu:[50,75,100],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Work Order",download:"open"},"csv","excel","print","copy"]}),$("#tblmaterial").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[8]}],order:[0,"asc"],lengthMenu:[50,75,100],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Raw Material",download:"open"},"csv","excel","print","copy"]}),$("#tblactivity").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[6]}],order:[0,"asc"],lengthMenu:[50,75,100],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Detail Activity",download:"open"},"csv","excel","print","copy"]}),$("#tblproblem").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[6]}],order:[0,"asc"],lengthMenu:[50,75,100],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Problem Work Order",download:"open"},"csv","excel","print","copy"]}),$("#tblserahterima").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[7]}],order:[0,"asc"],lengthMenu:[50,75,100],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Serah Terima Work Order",download:"open"},"csv","excel","print","copy"]}),$("#tblkaskeluar").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[7]}],order:[0,"asc"],lengthMenu:[50,75,100],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Kas Keluar",download:"open"},"csv","excel","print","copy"]}),$("#tblpembelian").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[6]}],order:[0,"asc"],lengthMenu:[50,75,100],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Pembelian Material",download:"open"},"csv","excel","print","copy"]}),$("#tblsupplier").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[6]}],order:[0,"asc"],lengthMenu:[20,40,60],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Supplier",download:"open"},"csv","excel","print","copy"]}),$("#tbluser").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[8]}],order:[0,"asc"],lengthMenu:[20,40,60],dom:"Bfrtip",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data User",download:"open"},"csv","excel","print","copy"]}),$("#tblrole").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[3]}],order:[0,"asc"],lengthMenu:[50,75,100],dom:"Bfrti",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Data Role Access",download:"open"},"csv","excel","print","copy"]}),$("#tblnotifikasi").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[3]}],order:[0,"asc"],lengthMenu:[20,40,60],dom:"Bfrti",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Notification Message",download:"open"},"csv","excel","print","copy"]}),$("#tblteknisi").DataTable({columnDefs:[{searchable:!1,orderable:!1,targets:[7]}],order:[0,"asc"],lengthMenu:[20,40,60],dom:"Bfrti",buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",title:"Teknisi",download:"open"},"csv","excel","print","copy"]})});